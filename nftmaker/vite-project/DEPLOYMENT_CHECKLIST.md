# デプロイ前チェックリスト

Vercelにデプロイする前に、以下の項目を確認してください。

## ✅ 必須チェック項目

### 1. ビルドの確認
- [ ] `npm run build` がローカルで成功することを確認
- [ ] TypeScriptエラーがないことを確認
- [ ] リンターエラーがないことを確認

### 2. 環境変数の設定
- [ ] `LIGHTHOUSE_API_KEY` をVercelダッシュボードで設定
- [ ] 環境変数が正しく読み込まれることを確認

### 3. API関数の確認
- [ ] `/api/sessions` (POST) - セッション作成
- [ ] `/api/sessions/:sessionId` (GET) - セッション状態取得
- [ ] `/api/sessions/:sessionId/upload` (POST) - 画像アップロード

### 4. フロントエンドの確認
- [ ] ルーティングが正しく動作することを確認
- [ ] QRコードが正しく生成されることを確認
- [ ] 画像アップロードが動作することを確認

## ⚠️ 注意事項

### セッション管理の制限

現在、セッションはメモリ内（`global.sessions`）で管理されています。Vercelのサーバーレス関数はステートレスなため：

- **同一リクエスト内でのみ有効**: 異なるリクエスト間でセッションが共有されない可能性があります
- **推奨**: 本番環境では、外部ストレージ（Redis、Upstash、Vercel KVなど）を使用することを推奨します

### ファイルサイズ制限

- Vercelのサーバーレス関数には10秒の実行時間制限があります
- 大きなファイルのアップロードには時間がかかる可能性があります
- 現在の制限: 10MB

### CORS設定

API関数でCORSを設定していますが、必要に応じて本番環境のドメインに制限してください。

## 🔧 トラブルシューティング

### ビルドエラーが発生する場合

1. ローカルで `npm run build` を実行してエラーを確認
2. TypeScriptの型エラーを修正
3. 依存関係が正しくインストールされているか確認

### APIが動作しない場合

1. Vercelダッシュボードの "Functions" タブでログを確認
2. 環境変数が正しく設定されているか確認
3. API関数のパスが正しいか確認

### セッションが見つからない場合

1. メモリベースのセッション管理の制限による可能性があります
2. 外部ストレージの導入を検討してください

## 📝 デプロイ後の確認

- [ ] フロントエンドが正しく表示される
- [ ] QRコードが生成される
- [ ] 画像アップロードが動作する
- [ ] IPFSアップロードが成功する
- [ ] NFTミントが動作する

